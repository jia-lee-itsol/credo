#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
오사카 교구 웹사이트 데이터를 기반으로 osaka.json 업데이트
https://ostk.catholic.jp/parish_mass/
"""

import json
import re
import os

def parse_mass_time(mass_time_str):
    """massTime 문자열을 파싱하여 massTimes와 foreignMassTimes 생성"""
    mass_times = {}
    foreign_mass_times = {}
    
    # 토요일 미사
    sat_match = re.search(r'土曜日?\s*(\d{1,2}):(\d{2})', mass_time_str)
    if sat_match:
        time_str = f"{sat_match.group(1)}:{sat_match.group(2)}"
        mass_times.setdefault("saturday", []).append(time_str)
    
    # 일요일 미사
    sun_matches = re.findall(r'日曜日?\s*(\d{1,2}):(\d{2})', mass_time_str)
    for match in sun_matches:
        time_str = f"{match[0]}:{match[1]}"
        # 외국어 미사인지 확인
        if not re.search(rf'{time_str}\s*\([^)]+\)', mass_time_str):
            mass_times.setdefault("sunday", []).append(time_str)
    
    # 외국어 미사 파싱
    foreign_patterns = [
        (r'(\d{1,2}):(\d{2})\s*\(([^)]+)\)', 'sunday'),
        (r'第(\d+)[,・]?第?(\d*)[日主]曜日?\s*(\d{1,2}):(\d{2})\s*\(([^)]+)\)', 'sunday'),
        (r'第(\d+)[,・]?第?(\d*)[土曜]\s*(\d{1,2}):(\d{2})\s*\(([^)]+)\)', 'saturday'),
    ]
    
    lang_map = {
        '英語': 'EN', '英語ミサ': 'EN', 'E': 'EN',
        'タガログ語': 'PH', 'T': 'PH',
        'ポルトガル語': 'PT', 'P': 'PT',
        'ベトナム語': 'VI', 'V': 'VI',
        'スペイン語': 'ES', 'S': 'ES',
        '中国語': 'CN',
        '韓国語': 'KR',
        'インドネシア語': 'ID',
        'ポーランド語': 'PL',
    }
    
    # 외국어 미사 시간 추출
    for pattern, day in foreign_patterns:
        matches = re.finditer(pattern, mass_time_str)
        for match in matches:
            if len(match.groups()) == 3:  # 단순 패턴
                hour, minute, lang_desc = match.groups()
                time_str = f"{hour}:{minute}"
                lang_code = None
                for key, code in lang_map.items():
                    if key in lang_desc:
                        lang_code = code
                        break
                if lang_code:
                    foreign_mass_times.setdefault(day, []).append({
                        "time": time_str,
                        "language": lang_code,
                        "note": ""
                    })
            elif len(match.groups()) >= 5:  # 第X日曜 패턴
                week_num = match.group(1)
                week_num2 = match.group(2) if match.group(2) else None
                hour = match.group(3) if len(match.groups()) >= 4 else match.group(2)
                minute = match.group(4) if len(match.groups()) >= 4 else match.group(3)
                lang_desc = match.group(5) if len(match.groups()) >= 5 else match.group(4)
                time_str = f"{hour}:{minute}"
                lang_code = None
                for key, code in lang_map.items():
                    if key in lang_desc:
                        lang_code = code
                        break
                if lang_code:
                    note = f"第{week_num}日曜"
                    if week_num2:
                        note = f"第{week_num}・第{week_num2}日曜"
                    foreign_mass_times.setdefault(day, []).append({
                        "time": time_str,
                        "language": lang_code,
                        "note": note
                    })
    
    # 평일 미사
    weekday_map = {'月': 'monday', '火': 'tuesday', '水': 'wednesday', '木': 'thursday', '金': 'friday'}
    for day_jp, day_en in weekday_map.items():
        matches = re.findall(rf'{day_jp}曜日?\s*(\d{{1,2}}):(\d{{2}})', mass_time_str)
        for match in matches:
            time_str = f"{match[0]}:{match[1]}"
            mass_times.setdefault(day_en, []).append(time_str)
    
    return mass_times, foreign_mass_times

# 웹사이트 데이터를 기반으로 교회 정보 생성
# 실제로는 웹 스크래핑을 하거나 수동으로 입력해야 하지만,
# 여기서는 웹사이트의 표 형식 데이터를 기반으로 구조를 만듭니다

parishes = []

# 大阪府 주요 교회들 (웹사이트 표 데이터 기반)
osaka_parishes_data = [
    ("カトリック阿倍野教会", "〒545-0053 大阪市阿倍野区松崎町3-6-25", "大阪府", "06-6621-6024", "日曜日 10:00", False),
    ("カトリック生野教会", "〒544-0011 大阪市生野区田島1-16-10", "大阪府", "06-6757-1792", "日曜日 9:30 / 11:00 (韓国語)", False),
    ("カトリック池田教会", "〒563-0041 池田市満寿美町9-26", "大阪府", "072-751-2400", "土曜日 18:00 / 日曜日 9:00", False),
    ("カトリック和泉教会", "〒594-0023 和泉市伯太町2-2-41", "大阪府", "0725-41-5768", "土曜日 19:30(第4) / 日曜日 9:30 / 第3日曜日 11:00 (英語)", False),
    ("カトリック泉佐野教会", "〒598-0004 泉佐野市市場南2-66-1", "大阪府", "072-463-2971", "土曜日 19:00 / 日曜日 8:00 / 9:30", False),
    ("カトリック茨木教会", "〒567-0888 茨木市駅前3-5-4", "大阪府", "072-622-4442", "日曜日 11:00", False),
    ("カトリック今市教会", "〒535-0001 大阪市旭区太子橋1-1-27", "大阪府", "06-6951-5018", "土曜日 19:00 / 日曜日 10:00 / 第4日曜日 8:30", False),
    ("カトリック大阪梅田教会", "〒531-0072 大阪市北区豊崎3-12-8", "大阪府", "06-6371-4060", "日曜日 7:00 / 9:00 (英語） / 11:00 / 13:00 (英語) / 第2日曜日 15:00 (スペイン語) / 第4土曜日 17:00 (インドネシア語)", False),
    ("カトリック大阪田辺教会", "〒546-0033 大阪市東住吉区南田辺2-12-25", "大阪府", "06-6692-2330", "日曜日 9:00", False),
    ("カトリック貝塚教会", "〒597-0071 貝塚市加神1-3-12", "大阪府", "072-422-5639", "日曜日 8:30 (5～10月) / 10:30 (11～4月)", False),
    ("カトリック門真教会", "〒571-0057 門真市元町5-16", "大阪府", "06-6908-5841", "日曜日 9:30 / 第1,3日曜日 13:00 (ベトナム語)", False),
    ("カトリック岸和田教会", "〒596-0057 岸和田市筋海町18-17", "大阪府", "072-437-3308", "日曜日 9:30 / 第4日曜日 11:00 (英語)", False),
    ("カトリック熊取教会", "〒590-0432 泉南郡熊取町小垣内3-5-39", "大阪府", "072-452-4680", "日曜日 10:30 (5～10月) / 8:30 (11～4月)", False),
    ("カトリック香里教会", "〒572-0081 寝屋川市東香里園町31-3", "大阪府", "072-834-3800", "日曜日 7:00 / 9:30", False),
    ("カトリック金剛教会", "〒584-0074 富田林市久野喜台2-4-10", "大阪府", "0721-29-3120", "日曜日 10:00", False),
    ("カトリック堺教会", "〒590-0024 堺市堺区向陵中町6-2-3", "大阪府", "072-252-1498", "日曜日 7:00 / 10:00 / 第2日曜日 14:00 (英語)", False),
    ("カトリック吹田教会", "〒564-0072 吹田市出口町17-21", "大阪府", "06-6388-1083", "日曜日 10:00 / 14:00 (英語)", False),
    ("カトリック住之江教会", "〒559-0013 大阪市住之江区御崎3-6-7", "大阪府", "06-6681-1895", "日曜日 9:00", False),
    ("カトリック関目教会", "〒536-0007 大阪市城東区成育4-8-25", "大阪府", "06-6931-4807", "日曜日 9:30", False),
    ("カトリック泉南教会", "〒590-0521 泉南市樽井9-2-8", "大阪府", "072-482-3668", "日曜日 8:30 / 第4日曜日 17:00 (スペイン語)", False),
    ("カトリック泉北教会", "〒590-0131 堺市南区栂393-4", "大阪府", "072-292-3820", "日曜日 9:30", False),
    ("カトリック千里ニュータウン教会", "〒560-0085 豊中市上新田2-13-2", "大阪府", "06-6832-1111", "日曜日 10:00", False),
    ("カトリック大東教会", "〒574-0011 大東市北条1-23-30", "大阪府", "072-876-5434", "土曜日 19:00 / 日曜日 10:00", False),
    ("カトリック高槻教会", "〒569-0077 高槻市野見町2-26", "大阪府", "072-675-1472", "日曜日 7:00 / 9:00", False),
    ("カトリック玉造教会", "〒540-0004 大阪市中央区玉造2-24-22", "大阪府", "06-6941-2332", "土曜日 18:30 / 日曜日 7:00 / 10:00 / 14:00 (英語) / 15:30 (ベトナム語) / 17:00 (韓国語)", False),
    ("カトリック豊中教会", "〒560-0021 豊中市本町6-1-6", "大阪府", "06-6852-4110", "日曜日 9:00", False),
    ("カトリックなみはや教会", "〒551-0002 大阪市大正区三軒家東5-11-7", "大阪府", "06-6551-6253", "日曜日 11:00", False),
    ("カトリック浜寺教会", "〒592-0002 高石市羽衣2-2-27", "大阪府", "072-261-1563", "日曜日 9:30 / 第2日曜日 11:00 (ポルトガル語)", False),
    ("カトリック枚岡教会", "〒579-8061 東大阪市六万寺町3-6-14", "大阪府", "072-984-4831", "日曜日 9:00", False),
    ("カトリック枚方教会", "〒573-0033 枚方市岡南町3-1", "大阪府", "072-841-5333", "土曜日 19:00 / 日曜日 9:00 / 11:00 / 第1日曜日 15:00 (ポルトガル語) / 第2日曜日 15:00 (英語) / 第4日曜日 15:00 (スペイン語)", False),
    ("カトリック平野教会", "〒547-0032 大阪市平野区流町4-2-26", "大阪府", "06-6709-1541", "日曜日 9:30", False),
    ("カトリック藤井寺教会", "〒583-0021 藤井寺市御舟町11-3", "大阪府", "072-955-4743", "日曜日 9:30", False),
    ("カトリック布施教会", "〒577-0809 東大阪市永和1-10-10", "大阪府", "06-6721-6214", "日曜日 11:00", False),
    ("カトリック岬教会", "〒599-0303 泉南郡岬町深日2240-2", "大阪府", "072-489-6601", "日曜日 8:30 (第1は前晩 18:00 )", False),
    ("カトリック箕面教会", "〒562-0013 箕面市坊島1-7-22", "大阪府", "072-721-2734", "日曜日 7:00 / 9:00", False),
    ("カトリック八尾教会", "〒581-0019 八尾市南小阪合町3-2-15", "大阪府", "072-999-1149", "日曜日 7:00 / 10:00 / 第3日曜日 15:00 (ベトナム語)", False),
]

# 和歌山県 교회들
wakayama_parishes_data = [
    ("カトリック紀伊田辺教会", "〒646-0036 田辺市上屋敷2-15-24", "和歌山県", "0739-22-0281", "前晩 16:00 (第4.5) / 日曜日 9:30 (第3) / 11:00 (第1.2)", False),
    ("カトリック紀の川教会", "〒649-6434 紀の川市中三谷160-1", "和歌山県", "0736-60-8712", "日曜日 10:30", False),
    ("カトリック串本教会", "〒649-3503 東牟婁郡串本町串本1495", "和歌山県", "0735-62-0573", "日曜日 9:00 (5～10月は 11:30 )", False),
    ("カトリック御坊教会", "〒644-0002 御坊市薗275-1", "和歌山県", "0738-22-3457", "前晩 16:00 (第2。11～3月は 15:00 ) / 日曜日 9:00 (第1,4) / 14:00 (第3,5)", False),
    ("カトリック新宮教会", "〒647-0044 新宮市神倉4-6-38", "和歌山県", "0735-22-3260", "日曜日 11:30 (復活祭～9月は 9:00 )", False),
    ("カトリック橋本教会", "〒648-0065 橋本市古佐田3-11-4", "和歌山県", "0736-32-0596", "日曜日 9:30", False),
    ("カトリック龍神教会", "〒645-0417 田辺市龍神村柳瀬18", "和歌山県", "0739-77-0132", "日曜日 9:00(第3は前晩 15:00 または 16:00、第4は 14:00 )", False),
    ("カトリック和歌山紀北教会", "〒640-8151 和歌山市屋形町3-33", "和歌山県", "073-425-1069", "日曜日 10:30", False),
    ("カトリック和歌山紀北教会 今福聖堂", "〒641-0044 和歌山市今福3-5-21", "和歌山県", "073-499-7333", "土曜日 16:00", False),
    ("カトリック和歌山紀北教会 海南聖堂", "〒642-0002 海南市日方1273-4", "和歌山県", "073-482-0896", "日曜日 14:00", False),
    ("カトリック和歌山紀北教会 古屋聖堂", "〒640-8435 和歌山市古屋182", "和歌山県", None, "日曜日 9:00", False),
]

# 香川県 교회들
kagawa_parishes_data = [
    ("カトリック観音寺教会", "〒768-0066 観音寺市昭和町1-6-57", "香川県", "0875-23-0004", "日曜日 9:30", False),
    ("カトリック坂出教会", "〒762-0033 坂出市谷町1-3-24", "香川県", "0877-46-5094", "土曜日 18:30 / 日曜日 9:00", False),
    ("カトリック桜町教会", "〒760-0074 高松市桜町1-8-9", "香川県", "087-831-7455", "土曜日 18:00 / 日曜日 7:00 / 10:00 / 第2,4日曜日 15:00 (英語)", True),
    ("カトリック三本松教会", "〒769-2606 東かがわ市水主396-1教区霊性センターC棟", "香川県", "0879-25-3871", "日曜日 10:00 (第3,5は 14:00 )", False),
    ("カトリック小豆島・土庄教会", "〒761-4121 小豆郡土庄町淵崎甲1430-3", "香川県", "0879-62-0847", "日曜日 14:00", False),
    ("カトリック小豆島・内海巡回教会", "〒761-4421 小豆郡小豆島町苗羽乙1212-17", "香川県", None, "なし", False),
    ("カトリック善通寺教会", "〒765-0011 善通寺市上吉田町4-9-24", "香川県", "0877-62-9752", "日曜日 9:00", False),
    ("カトリック番町教会", "〒760-0017 高松市番町2-4-31", "香川県", "087-823-0430", "日曜日 9:00", False),
    ("カトリック丸亀教会", "〒763-0048 丸亀市幸町2-6-28", "香川県", "0877-22-9620", "日曜日 10:30 / 第3土曜日 20:00 (スペイン語)", False),
]

# 愛媛県 교회들
ehime_parishes_data = [
    ("カトリック今治教会", "〒794-0028 今治市北宝来町1-2-13", "愛媛県", "0898-32-2348", "日曜日 10:00 / 第1日曜日 14:00 (英語) / 第4日曜日 14:00 (ベトナム語)", False),
    ("カトリック伊予三島教会", "〒799-0422 四国中央市中之庄町宮の上618-19", "愛媛県", "0896-24-6148", "日曜日 16:00", False),
    ("カトリック宇和島教会", "〒798-0060 宇和島市丸之内1-4-16", "愛媛県", "0895-24-4850", "日曜日 10:00 (第1,2は 13:00 )", False),
    ("カトリック西条教会", "〒793-0030 西条市大町716-1", "愛媛県", "0897-55-2787", "日曜日 14:00", False),
    ("カトリック道後教会", "〒790-0848 松山市道後喜多町7-25", "愛媛県", "089-924-7522", "日曜日 10:00", False),
    ("カトリック新居浜教会", "〒792-0011 新居浜市西原町1-4-6", "愛媛県", "0897-37-3122", "日曜日 9:30", False),
    ("カトリック松山教会", "〒790-0003 松山市三番町4-5-5", "愛媛県", "089-921-1849", "土曜日 18:00 / 日曜日10:00 / 15:00 (英語。月2回)", False),
    ("カトリック八幡浜教会", "〒796-0033 八幡浜市大正町1182-7", "愛媛県", "0894-22-3003", "日曜日 10:00(第1,2。第5は於・宇和島教会) / 13:00 (第3,4)", False),
]

# 徳島県 교회들
tokushima_parishes_data = [
    ("カトリック阿南教会", "〒774-0030 阿南市富岡町あ石19-1", "徳島県", "0884-22-1746", "日曜日 13:30 (要・確認)", False),
    ("カトリック池田教会", "〒778-0004 三好市池田町シンマチ1436-1", "徳島県", "0883-72-0495", "日曜日 13:00", False),
    ("カトリック徳島教会", "〒770-0854 徳島市徳島本町2-12", "徳島県", "088-626-2060", "土曜日 18:30 / 日曜日 9:30 / 第1,4日曜日 16:00 (英語) / 第2日曜日 15:00 (ベトナム語)", False),
    ("カトリック鳴門教会", "〒772-0001 鳴門市撫養町黒崎字松島208", "徳島県", "088-686-2774", "日曜日 10:00", False),
]

# 高知県 교회들
kochi_parishes_data = [
    ("カトリック江ノ口教会", "〒780-0062 高知市新本町1-7-31", "高知県", "088-872-2277", "日曜日 9:30", False),
    ("カトリック江ノ口教会 赤岡礼拝所", "〒781-5310 香南市赤岡町741-1", "高知県", None, "日曜日 14:00 (第2,4)", False),
    ("カトリック中島町教会", "〒780-0870 高知市本町5-6-26", "高知県", "088-872-3658", "日曜日 9:30 / 第1,3日曜日 14:00 (英語)", False),
    ("カトリック中島町教会 安芸礼拝所", "〒784-0004 安芸市本町4-4-30", "高知県", None, "前晩 16:00 (第1,3)", False),
    ("カトリック中村教会", "〒787-0012 四万十市右山五月町5-15", "高知県", "0880-34-8879", "日曜日 11:00", False),
]

# 兵庫県 주요 교회들
hyogo_parishes_data = [
    ("カトリック相生教会", "〒678-0008 相生市栄町17-1", "兵庫県", "0791-22-0087", "日曜日 9:00", False),
    ("カトリック明石教会", "〒673-0885 明石市桜町2-26", "兵庫県", "078-911-6330", "日曜日 9:30 / 第1日曜日 12:00 (英語) / 第3日曜日 13:00 (スペイン語) / 第4日曜日 14:00 (英語)", False),
    ("カトリック赤穂教会", "〒678-0237 赤穂市上仮屋北15-7", "兵庫県", "0791-42-2444", "日曜日 11:00", False),
    ("カトリック芦屋教会", "〒659-0065 芦屋市公光町5-15", "兵庫県", "0797-22-3982", "日曜日 11:00", False),
    ("カトリック網干教会", "〒671-1242 姫路市網干区浜田816", "兵庫県", "079-272-0404", "日曜日 11:00", False),
    ("カトリックたつの分教会", "〒679-4129 たつの市龍野町堂本66-9", "兵庫県", None, "日曜日 14:00", False),
    ("カトリック尼崎教会", "〒660-0804 尼崎市北大物町16-12", "兵庫県", "06-6481-4235", "土曜日 18:00 / 日曜日 9:30 / 14:00 (英語) / 第1日曜日 12:00 (スペイン語) / 第3日曜日 15:30 (ポルトガル語)", False),
    ("カトリック伊丹教会", "〒664-0882 伊丹市鈴原町1-9-1", "兵庫県", "072-772-2487", "日曜日 9:30", False),
    ("カトリック加古川教会", "〒675-0038 加古川市加古川町木村57", "兵庫県", "079-422-2870", "日曜日 9:30 / 第2,4土曜日 19:00 / 第1,3日曜日 13:00 (英語)", False),
    ("カトリック西脇分教会", "〒677-0052 西脇市和田町118", "兵庫県", None, "日曜日 16:00", False),
    ("カトリック北須磨教会", "〒654-0151 神戸市須磨区北落合2-3-1", "兵庫県", "078-791-3788", "日曜日 10:00", False),
    ("カトリック甲子園教会", "〒663-8152 西宮市甲子園町20-14", "兵庫県", "0798-41-1602", "日曜日 9:00", False),
    ("カトリック神戸中央教会", "〒650-0004 神戸市中央区中山手通1-28-7", "兵庫県", "078-221-4682", "日曜日 9:30 / 11:15 (英語) / 第3土曜日 15:00 (韓国語) / 第1日曜日 15:00 (ポルトガル語) / 第2日曜日 15:30 (インドネシア語) / 第5日曜日 14:00 (タガログ語)", True),
    ("カトリック佐用教会", "〒679-5301 佐用郡佐用町佐用2847", "兵庫県", "0790-82-4082", "土曜日 17:30", False),
    ("カトリック三田教会", "〒669-1532 三田市屋敷町8-15", "兵庫県", "079-562-4404", "日曜日 9:30", False),
    ("カトリック飾磨教会", "〒672-8064 姫路市飾磨区細江2586", "兵庫県", "079-233-0193", "日曜日 9:00 / 第1,3水曜日 11:30 (英語。休止期間あり)", False),
    ("カトリック夙川教会", "〒662-0052 西宮市霞町5-40", "兵庫県", "0798-22-1649", "土曜日 18:00 / 日曜日 7:00 / 10:00", False),
    ("カトリック鈴蘭台教会", "〒651-1114 神戸市北区鈴蘭台西町1-23-1", "兵庫県", "078-593-0025", "日曜日 9:30", False),
    ("カトリック住吉教会", "〒658-0053 神戸市東灘区住吉宮町2-18-23", "兵庫県", "078-851-2756", "日曜日 9:30 / 第1,3土曜日 19:00 (スペイン語)", False),
    ("カトリック洲本教会", "〒656-0051 洲本市物部1-11-12", "兵庫県", "0799-24-5144", "日曜日 10:00", False),
    ("カトリック園田教会", "〒661-0972 尼崎市小中島2-17-1", "兵庫県", "06-6491-4424", "日曜日 9:00", False),
    ("カトリックたかとり教会", "〒653-0052 神戸市長田区海運町3-3-8", "兵庫県", "078-731-8300", "日曜日 9:00", False),
    ("カトリック宝塚教会", "〒665-0011 宝塚市南口1-7-7", "兵庫県", "0797-72-4628", "土曜日 17:00 / 日曜日9:30", False),
    ("カトリック垂水教会", "〒655-0025 神戸市垂水区瑞ヶ丘2-9", "兵庫県", "078-707-4434", "日曜日 10:00（原則として）", False),
    ("カトリック豊岡教会", "〒668-0056 豊岡市妙楽寺28", "兵庫県", "0796-22-2018", "日曜日 10:00", False),
    ("カトリック仁川教会", "〒663-8006 西宮市段上町4-2-11", "兵庫県", "0798-51-0176", "土曜日 17:00 / 日曜日 7:00 / 9:00", False),
    ("カトリック日生中央教会", "〒666-0242 川辺郡猪名川町原字焼山597-4", "兵庫県", "072-766-1519", "日曜日 10:00", False),
    ("カトリック仁豊野教会", "〒670-0801 姫路市仁豊野900", "兵庫県", "079-264-0040", "日曜日 9:00(於・聖フランシスコ病院修道女会)", False),
    ("カトリック生野分教会", "〒679-3301 朝来市生野町口銀谷619", "兵庫県", None, "日曜日 14:00 (第2,4)", False),
    ("カトリック姫路教会", "〒670-0012 姫路市本町68", "兵庫県", "079-222-0043", "日曜日 7:00 / 10:00 (第5は国際ミサ) / 15:00 (英語。第5無し) / 第4土曜日 19:00 (ベトナム語)", False),
    ("カトリック兵庫教会", "〒652-0804 神戸市兵庫区塚本通4-4-4", "兵庫県", "078-575-5294", "日曜日 11:00", False),
    ("カトリック武庫之荘教会", "〒661-0035 尼崎市武庫之荘3-5-9", "兵庫県", "06-6431-7029", "日曜日 9:30", False),
    ("カトリック六甲教会", "〒657-0061 神戸市灘区赤松町3-1-21", "兵庫県", "078-851-2846", "土曜日 18:00 / 日曜日 7:30 / 10:00", False),
]

# 모든 교회 데이터 합치기
all_parishes_data = (osaka_parishes_data + hyogo_parishes_data + 
                     wakayama_parishes_data + kagawa_parishes_data + 
                     ehime_parishes_data + tokushima_parishes_data + 
                     kochi_parishes_data)

for name, address, prefecture, phone, mass_time, is_cathedral in all_parishes_data:
    mass_times, foreign_mass_times = parse_mass_time(mass_time)
    
    # deanery 결정
    if prefecture == "大阪府":
        deanery = "osaka"
    elif prefecture == "兵庫県":
        deanery = "hyogo"
    elif prefecture == "和歌山県":
        deanery = "wakayama"
    elif prefecture == "香川県":
        deanery = "kagawa"
    elif prefecture == "愛媛県":
        deanery = "ehime"
    elif prefecture == "徳島県":
        deanery = "tokushima"
    elif prefecture == "高知県":
        deanery = "kochi"
    else:
        deanery = "osaka"
    
    parish = {
        "name": name,
        "address": address,
        "prefecture": prefecture,
        "isCathedral": is_cathedral,
        "massTime": mass_time,
        "diocese": "osaka",
        "deanery": deanery,
        "massTimes": mass_times if mass_times else {},
        "foreignMassTimes": foreign_mass_times if foreign_mass_times else {},
        "latitude": 0.0,  # 임시 값, 나중에 geocoding으로 업데이트 필요
        "longitude": 0.0  # 임시 값, 나중에 geocoding으로 업데이트 필요
    }
    
    if phone:
        parish["phone"] = phone
    
    parishes.append(parish)

# 기존 파일 읽기
script_dir = os.path.dirname(os.path.abspath(__file__))
osaka_file = os.path.join(script_dir, '..', 'assets', 'data', 'parishes', 'osaka.json')

with open(osaka_file, 'r', encoding='utf-8') as f:
    existing_data = json.load(f)

# 기존 "神戸教会"를 "カトリック神戸中央教会"로 대체
# (이미 parishes에 포함되어 있음)

# JSON 파일로 저장
output_data = {
    "diocese": "osaka",
    "parishes": parishes
}

with open(osaka_file, 'w', encoding='utf-8') as f:
    json.dump(output_data, f, ensure_ascii=False, indent=2)

print(f"✅ osaka.json 업데이트 완료")
print(f"   총 {len(parishes)}개 교회 추가")
print(f"   - 大阪府: {len(osaka_parishes_data)}개")
print(f"   - 兵庫県: {len(hyogo_parishes_data)}개")
print(f"   - 和歌山県: {len(wakayama_parishes_data)}개")
print(f"   - 香川県: {len(kagawa_parishes_data)}개")
print(f"   - 愛媛県: {len(ehime_parishes_data)}개")
print(f"   - 徳島県: {len(tokushima_parishes_data)}개")
print(f"   - 高知県: {len(kochi_parishes_data)}개")
print(f"\n⚠️  주의:")
print(f"   - 위도/경도는 임시 값(0.0)입니다. geocoding 스크립트로 업데이트 필요")
print(f"   - 웹사이트의 모든 교회가 포함되지 않았을 수 있습니다. 추가 확인 필요")
