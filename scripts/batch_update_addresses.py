#!/usr/bin/env python3
"""
성당 주소를 배치로 업데이트하는 스크립트
찾은 주소들을 일괄 반영
"""
import json
import os

# 찾은 주소 매핑 (토큰 제한을 고려하여 배치로 추가)
ADDRESS_MAP = {
    "tokyo.json": {
        "カトリック高円寺教会": "東京都杉並区高円寺南4丁目39-17",
        "カトリック小金井教会": "東京都小金井市桜町1-2-20",
        "カトリック小平教会": "東京都小平市大沼町2-32-10",
        "カトリック三軒茶屋教会": "東京都世田谷区三軒茶屋2丁目51-32",
        "カトリック渋谷教会": "東京都渋谷区南平台町18-13",
        "カトリック志村教会": "東京都板橋区坂下1-38-22",
        "カトリック下井草教会": "東京都杉並区井草2-31-25",
        "カトリック成城教会": "東京都世田谷区成城2-21-16",
        "カトリック関町教会": "東京都練馬区関町北4丁目16-12",
        "カトリック瀬田教会": "東京都世田谷区瀬田4-16-1",
        "カトリック世田谷教会": "東京都世田谷区北沢1-45-12",
        "カトリック洗足教会": "東京都目黒区洗足2丁目26-13",
        "カトリック高輪教会": "東京都港区高輪4丁目7-1",
        "カトリック高幡教会": "東京都日野市程久保4-7-14",
        "カトリック立川教会": "東京都立川市錦町2-8-10",
        "カトリック調布教会": "東京都調布市富士見町3-21-12",
        "カトリック田園調布教会": "東京都大田区田園調布3丁目43番1号",
        "カトリック徳田教会": "東京都足立区千住橋戸町66",
        "カトリック豊島教会": "東京都豊島区長崎1丁目28-22",
        "カトリック豊田教会": "東京都日野市多摩平3-12-10",
        "カトリック八王子教会": "東京都八王子市本町16-3",
        "カトリック碑文谷教会": "東京都目黒区碑文谷1丁目26-24",
        "カトリック初台教会": "東京都渋谷区代々木5丁目16-3",
        "カトリック府中教会": "東京都府中市府中町1-40-11",
        "カトリック本郷教会": "東京都文京区本駒込5-4-3",
        "カトリック本所教会": "東京都墨田区東駒形1丁目1-15",
        "カトリック町田教会": "東京都町田市中町1丁目21-16",
        "カトリック町屋教会": "東京都荒川区町屋4-7-9",
        "カトリック松原教会": "東京都世田谷区松原3丁目30-2",
        "カトリック三河島教会": "東京都荒川区荒川3-11-1",
        "カトリック北町教会": "東京都練馬区北町3-16-1",
        "カトリック潮見教会": "東京都江東区潮見2丁目10-10",
        "カトリック秋津教会": "東京都東村山市秋津町5丁目24-1",
        "カトリックあきる野教会": "東京都あきる野市秋川1丁目1-1",
        "カトリック梅田教会": "東京都青梅市今井1丁目264-1",
        "カトリック青梅教会": "東京都青梅市勝沼1-197",
        "カトリック大島教会": "東京都大島町元町馬の背251",
        "フランシスカン・チャペル・センター": "東京都港区六本木4-2-37",
        "カトリック多摩教会": "東京都多摩市豊ヶ丘1-5-1",
        "カトリック鴨川教会": "千葉県鴨川市横渚1727-1",
        "カトリック木更津教会": "千葉県木更津市富士見3丁目1-13",
        "カトリック佐原教会": "千葉県香取市佐原イ417",
        "カトリック館山教会": "千葉県館山市北条1901-7",
        "カトリック銚子教会": "千葉県銚子市栄町1-1448",
        "カトリック富津教会": "千葉県富津市大堀2丁目16-10",
        "カトリック習志野教会": "千葉県習志野市津田沼6丁目12-12",
        "カトリック成田教会": "千葉県成田市公津の杜2-2-1",
        "カトリック西千葉教会": "千葉市中央区汐見丘町11-14",
        "カトリック茂原教会": "千葉県茂原市高師992",
    },
    "saitama.json": {
        "カトリック上尾教会": "埼玉県上尾市上106-1",
        "カトリック朝霞教会": "埼玉県朝霞市本町1丁目1-1",
        "カトリック春日部教会": "埼玉県春日部市中央5-7-15",
        "カトリック上福岡教会": "埼玉県ふじみ野市上福岡1-11-23",
        "カトリック川口教会": "埼玉県川口市川口6丁目4-2",
        "カトリック北浦和教会": "埼玉県さいたま市浦和区北浦和1丁目14-23",
        "カトリック行田教会": "埼玉県行田市旭町16-2",
        "カトリック熊谷教会": "埼玉県熊谷市末広2丁目115",
        "カトリック草加教会": "埼玉県草加市松江1丁目6-11",
        "カトリック秩父教会": "埼玉県秩父市宮側町14-16",
        "カトリック所沢教会": "埼玉県所沢市小手指町1-23-1",
        "カトリック深谷教会": "埼玉県深谷市栄町1-48",
        "カトリック峰教会": "栃木県宇都宮市峰2丁目19番9号",
        "カトリック飯能教会": "埼玉県飯能市仲町14-5",
        "カトリック東松山教会": "埼玉県東松山市神明町2-9-3",
        "カトリック本庄教会": "埼玉県本庄市千代田1-3-28",
        "カトリック足利教会": "栃木県足利市通3丁目2758",
        "カトリック今市教会": "栃木県日光市今市本町19-1",
        "カトリック大田原教会": "栃木県大田原市中央1丁目3-15",
        "カトリック鹿沼教会": "栃木県鹿沼市天神町1852-1",
        "カトリック鹿島教会": "茨城県神栖市大野原1-7-3",
        "カトリック古河教会": "茨城県古河市東1-5-1",
        "カトリック下館教会": "茨城県筑西市甲301-4",
        "カトリック常総教会": "茨城県常総市鴻野山字農場1443-8",
        "カトリック太田教会": "群馬県太田市東本町46-20",
        "カトリック上三川教会（巡回）": "栃木県河内郡上三川町上三川4917-1",
        "カトリック烏山教会": "栃木県那須烏山市金井2-5-8",
        "カトリック佐野教会": "栃木県佐野市若松町225",
        "カトリック栃木教会": "栃木県栃木市入舟町12-12",
        "カトリック那須教会": "栃木県那須郡那須町高久乙3370-1",
        "カトリック日光教会": "栃木県日光市御幸町5-1",
        "カトリック真岡教会": "栃木県真岡市荒町3-45-1",
        "カトリック大間々教会": "群馬県みどり市大間々町大間々1457-1",
        "カトリック草津教会（巡回）": "群馬県吾妻郡草津町草津647",
        "カトリック渋川教会": "群馬県渋川市渋川1694-18",
        "カトリック富岡教会": "群馬県富岡市富岡1161",
        "カトリック沼田教会": "群馬県沼田市鍛冶町967-2",
        "カトリック藤岡教会": "群馬県藤岡市藤岡855",
        "カトリック取手教会": "茨城県取手市戸頭219-1",
        "カトリック伊勢崎教会": "群馬県伊勢崎市中央町24-4",
        "カトリック桐生教会": "群馬県桐生市錦町1-3-52",
        "カトリック新町教会": "群馬県高崎市新町",
        "カトリック館林教会": "群馬県館林市緑町1-7-16",
        "カトリック中之条教会（巡回）": "群馬県吾妻郡中之条町大字中之条",
        "カトリック入間宮寺教会（巡回）": "埼玉県入間市宮寺2837",
        "カトリック友部教会": "茨城県笠間市大田町1071",
        "カトリック那珂教会（分）": "茨城県那珂市額田東郷480-1",
        "カトリック日立教会": "茨城県日立市神峰町2-10-6",
        "カトリック妙高教会": "新潟県妙高市田切字西原218-37",
        "カトリック新町教会": "群馬県高崎市新町2490-1",
        "カトリック中之条教会（巡回）": "群馬県吾妻郡中之条町1837",
        "カトリック上宿教会": "秋田県大仙市協和中淀川上宿13",
    },
    "niigata.json": {
        "カトリック大館教会": "秋田県大館市有浦1丁目7-45",
        "カトリック鹿角教会": "秋田県鹿角市十和田毛馬内字下小路25",
        "カトリック土崎教会": "秋田県秋田市土崎港南3-13-35",
        "カトリック能代教会": "秋田県能代市追分町2-50",
        "カトリック本荘教会": "秋田県由利本荘市給人町100-1",
        "カトリック横手教会": "秋田県横手市寿町7-25",
        "カトリック加茂教会": "新潟県加茂市寿町6-21",
        "カトリック三条教会": "新潟県三条市興野1-5-18",
        "カトリック見附教会": "新潟県見附市学校町2-14-4",
        "カトリック十日町教会": "新潟県十日町市本町6丁目3-22",
        "カトリック柏崎教会": "新潟県柏崎市柳橋町3-10",
        "カトリック新発田教会": "新潟県新発田市中央町1丁目7-7",
        "カトリック村上教会": "新潟県村上市若葉町14-5",
        "カトリック高田教会": "新潟県上越市西城町2-3-12",
        "カトリック新津教会": "新潟県新潟市秋葉区新津本町3丁目3-12",
        "カトリック直江津教会": "新潟県上越市西本町4丁目11-1",
        "カトリック高田教会": "新潟県上越市西城町2丁目3番12号",
        "カトリック佐渡教会": "新潟県佐渡市両津夷249",
        "カトリック花園教会": "新潟市中央区花園2-6-9",
        "カトリック鳥屋野教会": "新潟市中央区小張木2-7-46",
        "カトリック青山教会": "新潟市西区青山8-5-17",
        "カトリック寺尾教会": "新潟市西区寺尾上3-1-1",
        "カトリック白根教会": "新潟市南区上下諏訪木字前田甲107-1",
        "カトリック亀田教会": "新潟市江南区西町3-1-1",
        "カトリック村松教会": "五泉市村松甲2210",
        "カトリック長井教会": "山形県長井市屋城町3-27",
        "カトリック新庄教会": "山形県最上郡舟形町舟形445-1",
        "カトリック米沢教会": "山形県米沢市大町4丁目5番37号",
    },
    "sapporo.json": {
        "カトリック神居教会": "北海道旭川市神居4条9丁目1-25",
        "カトリック士別教会": "北海道士別市東3条1丁目",
        "カトリック砂川教会": "北海道砂川市東5条南3丁目3-1",
        "カトリック滝川教会": "北海道滝川市大町1丁目2-1",
        "カトリック名寄教会": "北海道名寄市西三条南4丁目",
        "カトリック松前教会": "北海道松前郡松前町字松城303",
    }
}

def is_incomplete_address(address: str) -> bool:
    """주소가 상세 주소를 포함하지 않는지 확인"""
    if not address:
        return True
    return not any(char in address for char in ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'ー', '丁目', '番地', '号'])

def update_addresses_in_file(file_path: str) -> int:
    """파일 내의 주소를 업데이트"""
    with open(file_path, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    filename = os.path.basename(file_path)
    updated_count = 0
    
    for parish in data.get('parishes', []):
        current_address = parish.get('address', '')
        parish_name = parish.get('name', '')
        
        # 이미 상세 주소가 있으면 스킵
        if not is_incomplete_address(current_address):
            continue
        
        # 알려진 주소가 있으면 사용
        if filename in ADDRESS_MAP and parish_name in ADDRESS_MAP[filename]:
            parish['address'] = ADDRESS_MAP[filename][parish_name]
            updated_count += 1
            print(f"✓ {parish_name}: {ADDRESS_MAP[filename][parish_name]}")
    
    if updated_count > 0:
        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    
    return updated_count

def main():
    """모든 성당 파일의 주소 업데이트"""
    parishes_dir = 'assets/data/parishes'
    total_updated = 0
    
    for filename in os.listdir(parishes_dir):
        if filename.endswith('.json') and filename != 'dioceses.json':
            file_path = os.path.join(parishes_dir, filename)
            updated = update_addresses_in_file(file_path)
            total_updated += updated
            if updated > 0:
                print(f"\n{filename}: {updated}개 주소 업데이트\n")
    
    print(f"총 {total_updated}개 주소 업데이트 완료")

if __name__ == '__main__':
    main()
