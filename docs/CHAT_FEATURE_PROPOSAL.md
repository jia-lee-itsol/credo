# ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„ ì œì•ˆì„œ

## ê°œìš”
ì‚¬ìš©ì ê°„ 1:1 ì±„íŒ… ë° ê·¸ë£¹ ì±„íŒ… ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ì•± ë‚´ì—ì„œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ êµí™˜ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.

## ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### 1. í•µì‹¬ ê¸°ëŠ¥
- âœ… **1:1 ì±„íŒ…**: ë‘ ì‚¬ìš©ì ê°„ ê°œì¸ ë©”ì‹œì§€
- âœ… **ê·¸ë£¹ ì±„íŒ…**: ì—¬ëŸ¬ ì‚¬ìš©ìì™€ì˜ ê·¸ë£¹ ëŒ€í™”
- âœ… **ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë™ê¸°í™”**: Firestore Streamì„ í†µí•œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- âœ… **ì½ìŒ ìƒíƒœ í‘œì‹œ**: ë©”ì‹œì§€ ì½ìŒ/ì•ˆ ì½ìŒ ìƒíƒœ í‘œì‹œ
- âœ… **ì´ë¯¸ì§€ ì „ì†¡**: ì±„íŒ…ì—ì„œ ì´ë¯¸ì§€ ê³µìœ  (ê°¤ëŸ¬ë¦¬/ì¹´ë©”ë¼)
- âœ… **í‘¸ì‹œ ì•Œë¦¼**: ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ FCM ì•Œë¦¼

### 2. UI/UX ê¸°ëŠ¥
- âœ… **ì±„íŒ… ëª©ë¡ í™”ë©´**: ëŒ€í™” ëª©ë¡ (ìµœì‹  ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°)
- âœ… **ì±„íŒ… í™”ë©´**: ë©”ì‹œì§€ ì…ë ¥ ë° í‘œì‹œ
- âœ… **ì‚¬ìš©ì ê²€ìƒ‰**: ì±„íŒ… ì‹œì‘ì„ ìœ„í•œ ì‚¬ìš©ì ê²€ìƒ‰
- âœ… **ì½ìŒ í‘œì‹œ**: ë©”ì‹œì§€ ì½ìŒ ìƒíƒœ í‘œì‹œ
- âœ… **íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°**: ìƒëŒ€ë°©ì´ ì…ë ¥ ì¤‘ì„ì„ í‘œì‹œ

### 3. ì¹œêµ¬ ì‹œìŠ¤í…œ âœ…
- âœ… **ì¹œêµ¬ ì¶”ê°€/ì‚­ì œ**: ì¹œêµ¬ ê´€ê³„ ê´€ë¦¬
- âœ… **ì¹œêµ¬ ì°¨ë‹¨**: íŠ¹ì • ì‚¬ìš©ì ì°¨ë‹¨
- âœ… **QR ì½”ë“œ ì¹œêµ¬ ì¶”ê°€**: QR ìŠ¤ìº”ìœ¼ë¡œ ì¹œêµ¬ ì¶”ê°€
- âœ… **ì¹œêµ¬ì—ê²Œë§Œ ë©”ì‹œì§€ ì „ì†¡**: ì¹œêµ¬ ê´€ê³„ê°€ ìˆëŠ” ì‚¬ìš©ìë§Œ ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥
- âœ… **ì¹œêµ¬ ê²€ìƒ‰**: ë‹‰ë„¤ì„, ì•„ì´ë””, ì´ë©”ì¼ë¡œ ì¹œêµ¬ ê²€ìƒ‰

### 4. ì±„íŒ…ë°© ê´€ë¦¬ âœ…
- âœ… **ì±„íŒ…ë°© ì •ë³´ í™”ë©´**: ì°¸ì—¬ì ëª©ë¡ ë° ì±„íŒ…ë°© ì •ë³´ í‘œì‹œ
- âœ… **ë©¤ë²„ ì´ˆëŒ€**: 1:1 ì±„íŒ…ì—ì„œ ë©¤ë²„ ì´ˆëŒ€ë¡œ ê·¸ë£¹ ì±„íŒ… ë³€í™˜
- âœ… **ì±„íŒ…ë°© ë‚˜ê°€ê¸°**: ì‹œìŠ¤í…œ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì±„íŒ…ë°© í‡´ì¥
- âœ… **ê·¸ë£¹ ì´ë¦„ ë³€ê²½**: ë°©ì¥ë§Œ ê·¸ë£¹ ì´ë¦„ ë³€ê²½ ê°€ëŠ¥
- âœ… **ì‹œìŠ¤í…œ ë©”ì‹œì§€**: ì…ì¥/í‡´ì¥/ì´ˆëŒ€ ë“± ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ í‘œì‹œ

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### Firestore Collections

#### 1. `conversations/{conversationId}`
ëŒ€í™”ë°© ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

```typescript
{
  conversationId: string;          // ë¬¸ì„œ ID
  participants: string[];           // ì°¸ì—¬ì userId ë°°ì—´
  type: "direct" | "group";        // ëŒ€í™” íƒ€ì…
  lastMessage?: {
    content: string;
    senderId: string;
    createdAt: Timestamp;
  };
  lastMessageAt?: Timestamp;       // ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°„
  createdAt: Timestamp;
  updatedAt: Timestamp;
  // ê·¸ë£¹ ì±„íŒ…ì˜ ê²½ìš°
  name?: string;                    // ê·¸ë£¹ ì´ë¦„
  imageUrl?: string;                // ê·¸ë£¹ ì´ë¯¸ì§€
  createdBy?: string;               // ê·¸ë£¹ ìƒì„±ì
}
```

#### 2. `conversations/{conversationId}/messages/{messageId}`
ê°œë³„ ë©”ì‹œì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤ (ì„œë¸Œì»¬ë ‰ì…˜).

```typescript
{
  messageId: string;                // ë¬¸ì„œ ID
  conversationId: string;           // ëŒ€í™”ë°© ID
  senderId: string;                 // ë°œì‹ ì userId ("system" for system messages)
  content: string;                  // ë©”ì‹œì§€ ë‚´ìš©
  type: "text" | "image" | "system"; // ë©”ì‹œì§€ íƒ€ì…
  imageUrls?: string[];             // ì´ë¯¸ì§€ URL ë°°ì—´
  readBy: {                         // ì½ìŒ ìƒíƒœ
    [userId: string]: Timestamp;    // userIdë³„ ì½ì€ ì‹œê°„
  };
  createdAt: Timestamp;
  updatedAt?: Timestamp;
}
```

#### 3. `friends/{friendId}`
ì¹œêµ¬ ê´€ê³„ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

```typescript
{
  odId: string;                     // ë¬¸ì„œ ID
  userId: string;                   // í˜„ì¬ ì‚¬ìš©ì
  friendId: string;                 // ìƒëŒ€ë°© ì‚¬ìš©ì
  status: "none" | "pending" | "accepted" | "blocked";
  createdAt: Timestamp;
  updatedAt?: Timestamp;
  nickname?: string;                // ì¹œêµ¬ì—ê²Œ ì„¤ì •í•œ ë³„ëª…
}
```

## Firestore Security Rules

```javascript
// Conversations Collection
match /conversations/{conversationId} {
  // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì (getì€ ëª¨ë‘ í—ˆìš©, listëŠ” ì°¸ì—¬ìë§Œ)
  allow get: if request.auth != null;
  allow list: if request.auth != null 
    && request.auth.uid in resource.data.participants;
  
  // ìƒì„±: ìì‹ ì„ ì°¸ì—¬ìë¡œ í¬í•¨í•´ì•¼ í•¨
  allow create: if request.auth != null 
    && request.auth.uid in request.resource.data.participants;
  
  // ìˆ˜ì •: ì°¸ì—¬ìë§Œ ìˆ˜ì • ê°€ëŠ¥
  allow update: if request.auth != null 
    && request.auth.uid in resource.data.participants;
  
  // ì‚­ì œ: ì°¸ì—¬ìë§Œ ì‚­ì œ ê°€ëŠ¥
  allow delete: if request.auth != null 
    && request.auth.uid in resource.data.participants;
  
  // Messages ì„œë¸Œì»¬ë ‰ì…˜
  match /messages/{messageId} {
    // ì½ê¸°: ì¸ì¦ëœ ì‚¬ìš©ì
    allow read: if request.auth != null;
    
    // ìƒì„±: ë°œì‹ ì IDê°€ ë³¸ì¸ì´ì–´ì•¼ í•¨
    allow create: if request.auth != null 
      && request.auth.uid == request.resource.data.senderId;
    
    // ìˆ˜ì •: ë°œì‹ ìë§Œ ìˆ˜ì • ê°€ëŠ¥ (readBy ì—…ë°ì´íŠ¸ í¬í•¨)
    allow update: if request.auth != null 
      && (resource.data.senderId == request.auth.uid 
          || request.resource.data.diff(resource.data).affectedKeys().hasOnly(['readBy', 'updatedAt']));
    
    // ì‚­ì œ: ë°œì‹ ìë§Œ ì‚­ì œ ê°€ëŠ¥
    allow delete: if request.auth != null 
      && resource.data.senderId == request.auth.uid;
  }
}

// Friends Collection
match /friends/{friendId} {
  allow read: if request.auth != null 
    && (resource.data.userId == request.auth.uid || resource.data.friendId == request.auth.uid);
  allow create: if request.auth != null 
    && request.resource.data.userId == request.auth.uid;
  allow update, delete: if request.auth != null 
    && resource.data.userId == request.auth.uid;
}
```

## ì•„í‚¤í…ì²˜ êµ¬ì¡°

### Domain Layer

#### Entities
```
lib/features/chat/domain/entities/
  â”œâ”€â”€ conversation_entity.dart      # ëŒ€í™”ë°© ì—”í‹°í‹° âœ…
  â”œâ”€â”€ message_entity.dart           # ë©”ì‹œì§€ ì—”í‹°í‹° âœ…
  â”œâ”€â”€ chat_user_entity.dart         # ì±„íŒ… ì‚¬ìš©ì ì •ë³´ ì—”í‹°í‹° âœ…
  â””â”€â”€ friend_entity.dart            # ì¹œêµ¬ ê´€ê³„ ì—”í‹°í‹° âœ…
```

#### Repositories
```
lib/features/chat/domain/repositories/
  â”œâ”€â”€ chat_repository.dart          # ì±„íŒ… Repository ì¸í„°í˜ì´ìŠ¤ âœ…
  â””â”€â”€ friend_repository.dart        # ì¹œêµ¬ Repository ì¸í„°í˜ì´ìŠ¤ âœ…
```

### Data Layer

#### Models
```
lib/features/chat/data/models/
  â”œâ”€â”€ conversation_model.dart        # Freezed ëª¨ë¸ âœ…
  â”œâ”€â”€ message_model.dart            # Freezed ëª¨ë¸ âœ…
  â”œâ”€â”€ chat_user_model.dart          # Freezed ëª¨ë¸ âœ…
  â””â”€â”€ friend_model.dart             # Freezed ëª¨ë¸ âœ…
```

#### Repositories
```
lib/features/chat/data/repositories/
  â”œâ”€â”€ firestore_chat_repository.dart   # Firestore êµ¬í˜„ âœ…
  â””â”€â”€ firestore_friend_repository.dart # Firestore êµ¬í˜„ âœ…
```

#### Providers
```
lib/features/chat/data/providers/
  â””â”€â”€ chat_repository_providers.dart   # Repository Providers âœ…
```

### Presentation Layer

#### Screens
```
lib/features/chat/presentation/screens/
  â”œâ”€â”€ chat_list_screen.dart          # ì±„íŒ… ëª©ë¡ âœ…
  â”œâ”€â”€ chat_screen.dart               # ì±„íŒ… í™”ë©´ âœ…
  â”œâ”€â”€ chat_info_screen.dart          # ì±„íŒ…ë°© ì •ë³´ âœ…
  â”œâ”€â”€ new_chat_screen.dart           # ìƒˆ ì±„íŒ… ì‹œì‘ âœ…
  â”œâ”€â”€ friend_list_screen.dart        # ì¹œêµ¬ ëª©ë¡ âœ…
  â””â”€â”€ user_profile_screen.dart       # ìœ ì € í”„ë¡œí•„ âœ…
```

#### Widgets
```
lib/features/chat/presentation/widgets/
  â”œâ”€â”€ chat_list_item.dart            # ì±„íŒ… ëª©ë¡ ì•„ì´í…œ âœ…
  â”œâ”€â”€ message_bubble.dart            # ë©”ì‹œì§€ ë²„ë¸” âœ…
  â”œâ”€â”€ message_input.dart             # ë©”ì‹œì§€ ì…ë ¥ í•„ë“œ âœ…
  â””â”€â”€ chat_user_search.dart          # ì‚¬ìš©ì ê²€ìƒ‰ âœ…
```

#### Providers
```
lib/features/chat/presentation/providers/
  â”œâ”€â”€ chat_providers.dart            # ì±„íŒ… ê´€ë ¨ Providers âœ…
  â””â”€â”€ friend_providers.dart          # ì¹œêµ¬ ê´€ë ¨ Providers âœ…
```

## êµ¬í˜„ ìƒíƒœ

### Phase 1: ê¸°ë³¸ ì¸í”„ë¼ âœ…
- [x] Firestore Collections êµ¬ì¡° ì„¤ê³„ ë° ìƒì„±
- [x] Security Rules ì‘ì„± ë° ë°°í¬
- [x] Domain Layer êµ¬í˜„ (Entities, Repository ì¸í„°í˜ì´ìŠ¤)
- [x] Data Layer êµ¬í˜„ (Models, Firestore Repository)

### Phase 2: 1:1 ì±„íŒ… ê¸°ëŠ¥ âœ…
- [x] ì±„íŒ… ëª©ë¡ í™”ë©´ êµ¬í˜„
- [x] ì±„íŒ… í™”ë©´ êµ¬í˜„ (ë©”ì‹œì§€ í‘œì‹œ, ì…ë ¥)
- [x] ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë™ê¸°í™”
- [x] ì‚¬ìš©ì ê²€ìƒ‰ ë° ìƒˆ ì±„íŒ… ì‹œì‘ ê¸°ëŠ¥

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ âœ…
- [x] ì½ìŒ ìƒíƒœ í‘œì‹œ
- [x] ì´ë¯¸ì§€ ì „ì†¡ ê¸°ëŠ¥ (ê°¤ëŸ¬ë¦¬/ì¹´ë©”ë¼ ì„ íƒ)
- [x] ë©”ì‹œì§€ ì‚­ì œ ê¸°ëŠ¥
- [x] ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ í‘œì‹œ
- [x] ì´ë¯¸ì§€ ì „ì²´ í™”ë©´ ë³´ê¸°

### Phase 4: í‘¸ì‹œ ì•Œë¦¼ âœ…
- [x] Cloud Functionsë¡œ ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼ ì „ì†¡
- [x] ì±„íŒ… ì•Œë¦¼ ì„¤ì • (ì•± ë‚´ ì„¤ì • ì—°ë™)

### Phase 5: ê·¸ë£¹ ì±„íŒ… âœ…
- [x] ê·¸ë£¹ ì±„íŒ… ìƒì„± (1:1ì—ì„œ ë©¤ë²„ ì´ˆëŒ€ë¡œ ë³€í™˜)
- [x] ê·¸ë£¹ ë©¤ë²„ ê´€ë¦¬ (ì´ˆëŒ€, ë‚˜ê°€ê¸°)
- [x] ê·¸ë£¹ ì •ë³´ ìˆ˜ì • (ì´ë¦„ ë³€ê²½)
- [x] ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì…ì¥/í‡´ì¥/ì´ˆëŒ€)

### Phase 6: ì¹œêµ¬ ì‹œìŠ¤í…œ âœ…
- [x] ì¹œêµ¬ ì¶”ê°€/ì‚­ì œ/ì°¨ë‹¨
- [x] QR ì½”ë“œë¡œ ì¹œêµ¬ ì¶”ê°€
- [x] ì¹œêµ¬ ê²€ìƒ‰ (ë‹‰ë„¤ì„, ì•„ì´ë””, ì´ë©”ì¼)
- [x] ì¹œêµ¬ì—ê²Œë§Œ ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥

## ì£¼ìš” êµ¬í˜„ í¬ì¸íŠ¸

### 1. ëŒ€í™”ë°© ID ìƒì„±
1:1 ì±„íŒ…ì˜ ê²½ìš°, ë‘ ì‚¬ìš©ì IDë¥¼ ì •ë ¬í•˜ì—¬ ê³ ìœ í•œ ëŒ€í™”ë°© IDë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```dart
String generateConversationId(String userId1, String userId2) {
  final sorted = [userId1, userId2]..sort();
  return '${sorted[0]}_${sorted[1]}';
}
```

### 2. ì‹¤ì‹œê°„ ë©”ì‹œì§€ ìŠ¤íŠ¸ë¦¼
```dart
Stream<List<Message>> watchMessages(String conversationId) {
  return _firestore
    .collection('conversations')
    .doc(conversationId)
    .collection('messages')
    .orderBy('createdAt', descending: false)
    .snapshots()
    .map((snapshot) => snapshot.docs
      .map((doc) => Message.fromFirestore(doc))
      .toList());
}
```

### 3. ë©¤ë²„ ì´ˆëŒ€ (ê·¸ë£¹ ì±„íŒ… ë³€í™˜)
```dart
Future<void> addMembersToConversation({
  required String conversationId,
  required List<String> memberIds,
  required String addedByNickname,
}) async {
  // 1. í˜„ì¬ ì°¸ì—¬ì ê°€ì ¸ì˜¤ê¸°
  // 2. ìƒˆ ë©¤ë²„ ì¶”ê°€
  // 3. 1:1 â†’ ê·¸ë£¹ìœ¼ë¡œ íƒ€ì… ë³€ê²½ (3ëª… ì´ìƒ)
  // 4. ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì „ì†¡
}
```

### 4. ì±„íŒ…ë°© ë‚˜ê°€ê¸°
```dart
Future<void> leaveConversation({
  required String conversationId,
  required String userId,
  required String userNickname,
}) async {
  // 1. ì°¸ì—¬ì ëª©ë¡ì—ì„œ ì œê±°
  // 2. ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì „ì†¡ ("{ë‹‰ë„¤ì„}ã•ã‚“ãŒãƒãƒ£ãƒƒãƒˆã‚’é€€å‡ºã—ã¾ã—ãŸ")
  // 3. ë§ˆì§€ë§‰ ì°¸ì—¬ìë©´ ëŒ€í™”ë°© ì‚­ì œ
}
```

### 5. ì‹œìŠ¤í…œ ë©”ì‹œì§€ íƒ€ì…
```dart
enum MessageType {
  text,    // ì¼ë°˜ í…ìŠ¤íŠ¸ ë©”ì‹œì§€
  image,   // ì´ë¯¸ì§€ ë©”ì‹œì§€
  system,  // ì‹œìŠ¤í…œ ë©”ì‹œì§€ (ì…ì¥/í‡´ì¥/ì´ˆëŒ€ ë“±)
}
```

### 6. ì´ë¯¸ì§€ ì „ì†¡
```dart
Future<void> _pickAndSendImage() async {
  // 1. ì´ë¯¸ì§€ ì†ŒìŠ¤ ì„ íƒ (ê°¤ëŸ¬ë¦¬/ì¹´ë©”ë¼)
  final source = await showModalBottomSheet<ImageSource>(...);
  
  // 2. ì´ë¯¸ì§€ ì„ íƒ
  final pickedFile = await _imagePicker.pickImage(
    source: source,
    imageQuality: 70,
    maxWidth: 1200,
  );
  
  // 3. Firebase Storage ì—…ë¡œë“œ
  final imageUrl = await _imageUploadService.uploadImage(...);
  
  // 4. ë©”ì‹œì§€ ì „ì†¡
  await sendMessage(ref, imageUrls: [imageUrl], ...);
}
```

### 7. íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
```dart
// Firestore êµ¬ì¡°: conversations/{id}/typing/{userId}
{
  userId: string;
  isTyping: boolean;
  updatedAt: Timestamp;
}

// 3ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ìë™ ì¢…ë£Œ
// 5ì´ˆ ì´ë‚´ ì—…ë°ì´íŠ¸ë§Œ í‘œì‹œ
```

### 8. ì±„íŒ… í‘¸ì‹œ ì•Œë¦¼ (Cloud Functions)
```typescript
export const onChatMessageCreated = onDocumentCreated(
  "conversations/{conversationId}/messages/{messageId}",
  async (event) => {
    // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì œì™¸
    // ë°œì‹ ì ì œì™¸í•œ ëª¨ë“  ì°¸ì—¬ìì—ê²Œ ì•Œë¦¼
    // ê·¸ë£¹ ì±„íŒ…: "{ê·¸ë£¹ëª…} - {ë°œì‹ ì}" í˜•ì‹
    // ì´ë¯¸ì§€: "ğŸ“· ì‚¬ì§„ì„ ë³´ëƒˆìŠµë‹ˆë‹¤." í‘œì‹œ
  }
);
```

## ë¼ìš°íŒ…

```dart
// app_routes.dart
static const String chatList = '/chat';
static String chatPath(String conversationId) => '/chat/$conversationId';
static String chatInfoPath(String conversationId) => '/chat/$conversationId/info';
static const String newChat = '/chat/new';
static const String friendList = '/friends';
static String userProfilePath(String userId) => '/user/$userId';

// app_router.dart
GoRoute(
  path: AppRoutes.chatList,
  builder: (context, state) => const ChatListScreen(),
  routes: [
    GoRoute(
      path: 'new',
      builder: (context, state) => const NewChatScreen(),
    ),
    GoRoute(
      path: ':conversationId',
      builder: (context, state) {
        final conversationId = state.pathParameters['conversationId']!;
        return ChatScreen(conversationId: conversationId);
      },
      routes: [
        GoRoute(
          path: 'info',
          builder: (context, state) {
            final conversationId = state.pathParameters['conversationId']!;
            return ChatInfoScreen(conversationId: conversationId);
          },
        ),
      ],
    ),
  ],
),
GoRoute(
  path: AppRoutes.friendList,
  builder: (context, state) => const FriendListScreen(),
),
GoRoute(
  path: '/user/:userId',
  builder: (context, state) {
    final userId = state.pathParameters['userId']!;
    return UserProfileScreen(userId: userId);
  },
),
```

## Firestore ì¸ë±ìŠ¤

ë‹¤ìŒ ì¸ë±ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤:

```json
{
  "indexes": [
    {
      "collectionGroup": "conversations",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "participants", "arrayConfig": "CONTAINS" },
        { "fieldPath": "lastMessageAt", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "messages",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "conversationId", "order": "ASCENDING" },
        { "fieldPath": "createdAt", "order": "ASCENDING" }
      ]
    },
    {
      "collectionGroup": "friends",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "userId", "order": "ASCENDING" },
        { "fieldPath": "status", "order": "ASCENDING" }
      ]
    }
  ]
}
```

## ë¹„ìš© ê³ ë ¤ì‚¬í•­

### Firestore ì½ê¸°/ì“°ê¸°
- ë©”ì‹œì§€ ì „ì†¡: 1 write (message) + 1 write (conversation ì—…ë°ì´íŠ¸)
- ë©”ì‹œì§€ ì½ê¸°: 1 read per message
- ì±„íŒ… ëª©ë¡ ì¡°íšŒ: 1 read per conversation

### Cloud Functions
- ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼: ì°¸ì—¬ì ìˆ˜ë§Œí¼ FCM ì „ì†¡

### ìµœì í™” ë°©ì•ˆ
- ë©”ì‹œì§€ í˜ì´ì§€ë„¤ì´ì…˜ (í•œ ë²ˆì— 20-50ê°œì”© ë¡œë“œ)
- ì±„íŒ… ëª©ë¡ ìºì‹±
- ì½ìŒ ìƒíƒœëŠ” ë°°ì¹˜ë¡œ ì—…ë°ì´íŠ¸

## ë‚¨ì€ ì‘ì—…

### ìš°ì„ ìˆœìœ„ ë†’ìŒ
1. [x] ~~ì´ë¯¸ì§€ ì „ì†¡ ê¸°ëŠ¥ êµ¬í˜„~~ âœ…
2. [x] ~~Cloud Functionsë¡œ ì±„íŒ… ì•Œë¦¼ ì „ì†¡~~ âœ…
3. [x] ~~íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°~~ âœ…

### ìš°ì„ ìˆœìœ„ ì¤‘ê°„
1. [x] ~~ë©”ì‹œì§€ ê²€ìƒ‰ ê¸°ëŠ¥~~ âœ…
2. [ ] ì±„íŒ…ë°© ì´ë¯¸ì§€ ì„¤ì •

### ìš°ì„ ìˆœìœ„ ë‚®ìŒ
1. [ ] ë©”ì‹œì§€ ë°˜ì‘ (ì´ëª¨ì§€)
2. [ ] ë©”ì‹œì§€ ë‹µì¥
3. [ ] ë©”ì‹œì§€ ì „ë‹¬
